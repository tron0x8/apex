
SQL_INJECTION:
  - name: mysql_query
    pattern: 'mysql_query\s*\('
    severity: CRITICAL
    cwe: CWE-89
    description: "MySQL query execution"

  - name: mysqli_query
    pattern: 'mysqli_query\s*\('
    severity: CRITICAL
    cwe: CWE-89
    description: "MySQLi query execution"

  - name: mysqli_multi_query
    pattern: 'mysqli_multi_query\s*\('
    severity: CRITICAL
    cwe: CWE-89
    description: "MySQLi multi-query execution"

  - name: pg_query
    pattern: 'pg_query\s*\('
    severity: CRITICAL
    cwe: CWE-89
    description: "PostgreSQL query execution"

  - name: pg_send_query
    pattern: 'pg_send_query\s*\('
    severity: CRITICAL
    cwe: CWE-89
    description: "PostgreSQL async query execution"

  - name: sqlite_query
    pattern: 'sqlite_query\s*\('
    severity: CRITICAL
    cwe: CWE-89
    description: "SQLite query execution"

  - name: sqlite_exec
    pattern: 'sqlite_exec\s*\('
    severity: CRITICAL
    cwe: CWE-89
    description: "SQLite query execution"

  - name: odbc_exec
    pattern: 'odbc_exec\s*\('
    severity: CRITICAL
    cwe: CWE-89
    description: "ODBC query execution"

  - name: mssql_query
    pattern: 'mssql_query\s*\('
    severity: CRITICAL
    cwe: CWE-89
    description: "MS SQL query execution"

  - name: sqlsrv_query
    pattern: 'sqlsrv_query\s*\('
    severity: CRITICAL
    cwe: CWE-89
    description: "SQL Server query execution"

  - name: query
    pattern: 'query\s*\('
    severity: CRITICAL
    cwe: CWE-89
    description: "Generic database query execution"

  - name: PDO::query
    pattern: 'PDO::query\s*\('
    severity: CRITICAL
    cwe: CWE-89
    description: "PDO query execution"

  - name: PDO::exec
    pattern: 'PDO::exec\s*\('
    severity: CRITICAL
    cwe: CWE-89
    description: "PDO statement execution"

COMMAND_INJECTION:
  - name: exec
    pattern: 'exec\s*\('
    severity: CRITICAL
    cwe: CWE-78
    description: "Execute external command"

  - name: system
    pattern: 'system\s*\('
    severity: CRITICAL
    cwe: CWE-78
    description: "Execute system command"

  - name: shell_exec
    pattern: 'shell_exec\s*\('
    severity: CRITICAL
    cwe: CWE-78
    description: "Execute shell command"

  - name: passthru
    pattern: 'passthru\s*\('
    severity: CRITICAL
    cwe: CWE-78
    description: "Execute command and pass output"

  - name: popen
    pattern: 'popen\s*\('
    severity: CRITICAL
    cwe: CWE-78
    description: "Open process file pointer"

  - name: proc_open
    pattern: 'proc_open\s*\('
    severity: CRITICAL
    cwe: CWE-78
    description: "Execute command and open file pointers"

  - name: pcntl_exec
    pattern: 'pcntl_exec\s*\('
    severity: CRITICAL
    cwe: CWE-78
    description: "Execute program in current process space"

  - name: backtick
    pattern: '`[^`]*`'
    severity: CRITICAL
    cwe: CWE-78
    description: "Backtick operator for shell execution"

CODE_INJECTION:
  - name: eval
    pattern: 'eval\s*\('
    severity: CRITICAL
    cwe: CWE-94
    description: "Evaluate arbitrary code"

  - name: assert
    pattern: 'assert\s*\('
    severity: CRITICAL
    cwe: CWE-94
    description: "Assert with string evaluation"

  - name: create_function
    pattern: 'create_function\s*\('
    severity: CRITICAL
    cwe: CWE-94
    description: "Create anonymous function from strings"

  - name: call_user_func
    pattern: 'call_user_func\s*\('
    severity: CRITICAL
    cwe: CWE-94
    description: "Call user function by name"

  - name: call_user_func_array
    pattern: 'call_user_func_array\s*\('
    severity: CRITICAL
    cwe: CWE-94
    description: "Call user function with array parameters"

  - name: array_map
    pattern: 'array_map\s*\('
    severity: HIGH
    cwe: CWE-94
    description: "Apply callback to array elements"

  - name: array_filter
    pattern: 'array_filter\s*\('
    severity: HIGH
    cwe: CWE-94
    description: "Filter array elements with callback"

  - name: usort
    pattern: 'usort\s*\('
    severity: HIGH
    cwe: CWE-94
    description: "Sort array with user-defined comparison"

  - name: uasort
    pattern: 'uasort\s*\('
    severity: HIGH
    cwe: CWE-94
    description: "Sort array with user-defined comparison maintaining keys"

FILE_INCLUDE:
  - name: include
    pattern: 'include\s*\('
    severity: CRITICAL
    cwe: CWE-98
    description: "Include and evaluate file"
    context_sensitive: true

  - name: include_once
    pattern: 'include_once\s*\('
    severity: CRITICAL
    cwe: CWE-98
    description: "Include and evaluate file once"
    context_sensitive: true

  - name: require
    pattern: 'require\s*\('
    severity: CRITICAL
    cwe: CWE-98
    description: "Require and evaluate file"
    context_sensitive: true

  - name: require_once
    pattern: 'require_once\s*\('
    severity: CRITICAL
    cwe: CWE-98
    description: "Require and evaluate file once"
    context_sensitive: true

FILE_PATH:
  - name: file_get_contents
    pattern: 'file_get_contents\s*\('
    severity: HIGH
    cwe: CWE-73
    description: "Read entire file into string"
    context_sensitive: true

  - name: file_put_contents
    pattern: 'file_put_contents\s*\('
    severity: CRITICAL
    cwe: CWE-73
    description: "Write data to file"

  - name: fopen
    pattern: 'fopen\s*\('
    severity: HIGH
    cwe: CWE-73
    description: "Open file or URL"

  - name: fread
    pattern: 'fread\s*\('
    severity: HIGH
    cwe: CWE-73
    description: "Binary-safe file read"

  - name: fwrite
    pattern: 'fwrite\s*\('
    severity: CRITICAL
    cwe: CWE-73
    description: "Binary-safe file write"

  - name: unlink
    pattern: 'unlink\s*\('
    severity: HIGH
    cwe: CWE-73
    description: "Delete file"

  - name: copy
    pattern: 'copy\s*\('
    severity: HIGH
    cwe: CWE-73
    description: "Copy file"

  - name: rename
    pattern: 'rename\s*\('
    severity: HIGH
    cwe: CWE-73
    description: "Rename file or directory"

  - name: move_uploaded_file
    pattern: 'move_uploaded_file\s*\('
    severity: HIGH
    cwe: CWE-73
    description: "Move uploaded file to new location"

  - name: readfile
    pattern: 'readfile\s*\('
    severity: HIGH
    cwe: CWE-73
    description: "Output file contents"

  - name: file
    pattern: 'file\s*\('
    severity: HIGH
    cwe: CWE-73
    description: "Read entire file into array"

  - name: mkdir
    pattern: 'mkdir\s*\('
    severity: HIGH
    cwe: CWE-73
    description: "Create directory"

  - name: rmdir
    pattern: 'rmdir\s*\('
    severity: HIGH
    cwe: CWE-73
    description: "Remove directory"

XSS:
  - name: echo
    pattern: 'echo\s+'
    severity: HIGH
    cwe: CWE-79
    description: "Output data to browser"

  - name: print
    pattern: 'print\s+'
    severity: HIGH
    cwe: CWE-79
    description: "Output data to browser"

  - name: printf
    pattern: 'printf\s*\('
    severity: HIGH
    cwe: CWE-79
    description: "Output formatted string"

  - name: vprintf
    pattern: 'vprintf\s*\('
    severity: HIGH
    cwe: CWE-79
    description: "Output formatted string with array"

  - name: die
    pattern: 'die\s*\('
    severity: MEDIUM
    cwe: CWE-79
    description: "Output message and terminate"

  - name: exit
    pattern: 'exit\s*\('
    severity: MEDIUM
    cwe: CWE-79
    description: "Output message and terminate"

SERIALIZATION:
  - name: unserialize
    pattern: 'unserialize\s*\('
    severity: CRITICAL
    cwe: CWE-502
    description: "Deserialize data (object injection risk)"

  - name: yaml_parse
    pattern: 'yaml_parse\s*\('
    severity: CRITICAL
    cwe: CWE-502
    description: "Parse YAML string (code execution risk)"

XXE:
  - name: simplexml_load_string
    pattern: 'simplexml_load_string\s*\('
    severity: HIGH
    cwe: CWE-611
    description: "Parse XML string"

  - name: simplexml_load_file
    pattern: 'simplexml_load_file\s*\('
    severity: HIGH
    cwe: CWE-611
    description: "Parse XML file"

  - name: DOMDocument::loadXML
    pattern: 'DOMDocument::loadXML\s*\('
    severity: HIGH
    cwe: CWE-611
    description: "Load XML document"

  - name: XMLReader::open
    pattern: 'XMLReader::open\s*\('
    severity: HIGH
    cwe: CWE-611
    description: "Open XML reader"

SSRF:
  - name: curl_setopt
    pattern: 'curl_setopt\s*\('
    severity: HIGH
    cwe: CWE-918
    description: "Set cURL option (URL manipulation)"

  - name: curl_exec
    pattern: 'curl_exec\s*\('
    severity: HIGH
    cwe: CWE-918
    description: "Execute cURL session"

  - name: fsockopen
    pattern: 'fsockopen\s*\('
    severity: HIGH
    cwe: CWE-918
    description: "Open socket connection"

  - name: socket_connect
    pattern: 'socket_connect\s*\('
    severity: HIGH
    cwe: CWE-918
    description: "Initiate socket connection"

REDIRECT:
  - name: header
    pattern: 'header\s*\('
    severity: MEDIUM
    cwe: CWE-601
    description: "Send HTTP header (open redirect risk)"

EMAIL:
  - name: mail
    pattern: 'mail\s*\('
    severity: HIGH
    cwe: CWE-88
    description: "Send email (header injection risk)"

NOSQL:
  - name: find
    pattern: 'find\s*\('
    severity: HIGH
    cwe: CWE-943
    description: "NoSQL query operation"

  - name: findOne
    pattern: 'findOne\s*\('
    severity: HIGH
    cwe: CWE-943
    description: "NoSQL single document query"

  - name: aggregate
    pattern: 'aggregate\s*\('
    severity: HIGH
    cwe: CWE-943
    description: "NoSQL aggregation operation"

LDAP:
  - name: ldap_search
    pattern: 'ldap_search\s*\('
    severity: HIGH
    cwe: CWE-90
    description: "LDAP search operation"

  - name: ldap_bind
    pattern: 'ldap_bind\s*\('
    severity: HIGH
    cwe: CWE-90
    description: "LDAP bind operation"

PATTERN_ARG_SINKS:
  - name: preg_replace
    pattern: 'preg_replace\s*\('
    severity: CRITICAL
    cwe: CWE-94
    description: "Regular expression replace (code execution with /e modifier)"
    arg_position: 0

  - name: preg_match
    pattern: 'preg_match\s*\('
    severity: HIGH
    cwe: CWE-185
    description: "Regular expression match (ReDoS risk)"
    arg_position: 0

  - name: preg_match_all
    pattern: 'preg_match_all\s*\('
    severity: HIGH
    cwe: CWE-185
    description: "Regular expression match all (ReDoS risk)"
    arg_position: 0

  - name: preg_grep
    pattern: 'preg_grep\s*\('
    severity: HIGH
    cwe: CWE-185
    description: "Regular expression grep (ReDoS risk)"
    arg_position: 0

  - name: preg_split
    pattern: 'preg_split\s*\('
    severity: HIGH
    cwe: CWE-185
    description: "Regular expression split (ReDoS risk)"
    arg_position: 0

ENVIRONMENT:
  - name: putenv
    pattern: 'putenv\s*\('
    severity: HIGH
    cwe: CWE-78
    description: "Set environment variable (env injection)"

  - name: ini_set
    pattern: 'ini_set\s*\('
    severity: HIGH
    cwe: CWE-94
    description: "Modify PHP configuration at runtime"

  - name: dl
    pattern: '\bdl\s*\('
    severity: CRITICAL
    cwe: CWE-94
    description: "Load PHP extension at runtime"

  - name: set_include_path
    pattern: 'set_include_path\s*\('
    severity: HIGH
    cwe: CWE-98
    description: "Modify include path"

REFLECTION:
  - name: ReflectionClass
    pattern: 'new\s+ReflectionClass\s*\('
    severity: HIGH
    cwe: CWE-470
    description: "Reflection on class name"

  - name: ReflectionFunction
    pattern: 'new\s+ReflectionFunction\s*\('
    severity: HIGH
    cwe: CWE-470
    description: "Reflection on function name"

  - name: ReflectionMethod
    pattern: 'new\s+ReflectionMethod\s*\('
    severity: HIGH
    cwe: CWE-470
    description: "Reflection on method name"

  - name: class_exists
    pattern: 'class_exists\s*\('
    severity: MEDIUM
    cwe: CWE-470
    description: "Class existence check (may trigger autoload)"

CALLBACK:
  - name: ob_start_callback
    pattern: 'ob_start\s*\('
    severity: MEDIUM
    cwe: CWE-94
    description: "Output buffer with callback"

  - name: register_shutdown_function
    pattern: 'register_shutdown_function\s*\('
    severity: HIGH
    cwe: CWE-94
    description: "Register shutdown callback"

  - name: register_tick_function
    pattern: 'register_tick_function\s*\('
    severity: HIGH
    cwe: CWE-94
    description: "Register tick callback"

  - name: spl_autoload_register
    pattern: 'spl_autoload_register\s*\('
    severity: HIGH
    cwe: CWE-94
    description: "Register autoloader"

  - name: set_error_handler
    pattern: 'set_error_handler\s*\('
    severity: MEDIUM
    cwe: CWE-94
    description: "Set error handler callback"

  - name: array_walk
    pattern: 'array_walk\s*\('
    severity: HIGH
    cwe: CWE-94
    description: "Apply callback to array"

  - name: array_walk_recursive
    pattern: 'array_walk_recursive\s*\('
    severity: HIGH
    cwe: CWE-94
    description: "Apply callback to array recursively"

  - name: iterator_apply
    pattern: 'iterator_apply\s*\('
    severity: HIGH
    cwe: CWE-94
    description: "Apply function to iterator"

NETWORK:
  - name: stream_context_create
    pattern: 'stream_context_create\s*\('
    severity: MEDIUM
    cwe: CWE-295
    description: "Stream context (SSL/TLS config)"

  - name: stream_socket_client
    pattern: 'stream_socket_client\s*\('
    severity: HIGH
    cwe: CWE-918
    description: "Socket client connection"

  - name: stream_socket_server
    pattern: 'stream_socket_server\s*\('
    severity: HIGH
    cwe: CWE-918
    description: "Socket server binding"

  - name: SoapClient
    pattern: 'new\s+SoapClient\s*\('
    severity: HIGH
    cwe: CWE-918
    description: "SOAP client (SSRF risk)"

  - name: dns_get_record
    pattern: 'dns_get_record\s*\('
    severity: MEDIUM
    cwe: CWE-918
    description: "DNS lookup"

  - name: gethostbyname
    pattern: 'gethostbyname\s*\('
    severity: MEDIUM
    cwe: CWE-918
    description: "Hostname to IP resolution"

PERMISSION:
  - name: chmod
    pattern: 'chmod\s*\('
    severity: MEDIUM
    cwe: CWE-732
    description: "Change file permissions"

  - name: chown
    pattern: 'chown\s*\('
    severity: HIGH
    cwe: CWE-732
    description: "Change file owner"

  - name: chgrp
    pattern: 'chgrp\s*\('
    severity: MEDIUM
    cwe: CWE-732
    description: "Change file group"

  - name: symlink
    pattern: 'symlink\s*\('
    severity: HIGH
    cwe: CWE-59
    description: "Create symbolic link"

  - name: link
    pattern: '\blink\s*\('
    severity: HIGH
    cwe: CWE-59
    description: "Create hard link"

  - name: tempnam
    pattern: 'tempnam\s*\('
    severity: MEDIUM
    cwe: CWE-377
    description: "Create temporary file"

SESSION:
  - name: session_id
    pattern: 'session_id\s*\('
    severity: HIGH
    cwe: CWE-384
    description: "Set session ID (session fixation)"

  - name: setrawcookie
    pattern: 'setrawcookie\s*\('
    severity: MEDIUM
    cwe: CWE-565
    description: "Set raw cookie (no encoding)"

  - name: session_name
    pattern: 'session_name\s*\('
    severity: MEDIUM
    cwe: CWE-384
    description: "Set session name"

  - name: session_save_path
    pattern: 'session_save_path\s*\('
    severity: HIGH
    cwe: CWE-384
    description: "Set session save path"

LOG:
  - name: error_log
    pattern: 'error_log\s*\('
    severity: MEDIUM
    cwe: CWE-117
    description: "Error logging"

  - name: syslog
    pattern: 'syslog\s*\('
    severity: MEDIUM
    cwe: CWE-117
    description: "System logging"

  - name: trigger_error
    pattern: 'trigger_error\s*\('
    severity: LOW
    cwe: CWE-209
    description: "Trigger PHP error"

DATABASE_EXTENDED:
  - name: sqlite3_exec
    pattern: '->exec\s*\('
    severity: HIGH
    cwe: CWE-89
    description: "SQLite3 exec method"

  - name: sqlite3_query
    pattern: '->querySingle\s*\('
    severity: HIGH
    cwe: CWE-89
    description: "SQLite3 querySingle method"

  - name: cubrid_execute
    pattern: 'cubrid_execute\s*\('
    severity: CRITICAL
    cwe: CWE-89
    description: "CUBRID query execution"

  - name: db2_exec
    pattern: 'db2_exec\s*\('
    severity: CRITICAL
    cwe: CWE-89
    description: "DB2 query execution"

  - name: ibase_query
    pattern: 'ibase_query\s*\('
    severity: CRITICAL
    cwe: CWE-89
    description: "Firebird/InterBase query"

  - name: maxdb_query
    pattern: 'maxdb_query\s*\('
    severity: CRITICAL
    cwe: CWE-89
    description: "MaxDB query execution"

  - name: oci_execute
    pattern: 'oci_execute\s*\('
    severity: CRITICAL
    cwe: CWE-89
    description: "Oracle execute"

VARIABLE_MANIPULATION:
  - name: extract
    pattern: 'extract\s*\('
    severity: HIGH
    cwe: CWE-621
    description: "Extract variables from array (variable overwrite)"

  - name: parse_str
    pattern: 'parse_str\s*\('
    severity: HIGH
    cwe: CWE-621
    description: "Parse query string into variables"

  - name: setcookie
    pattern: 'setcookie\s*\('
    severity: MEDIUM
    cwe: CWE-565
    description: "Set cookie (injection risk)"
